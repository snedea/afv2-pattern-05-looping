{
  "nodes": [
    {
      "id": "startAgentflow_0",
      "type": "agentFlow",
      "position": {
        "x": -700,
        "y": 200
      },
      "data": {
        "id": "startAgentflow_0",
        "label": "Start",
        "version": 1.1,
        "name": "startAgentflow",
        "type": "Start",
        "color": "#7EE787",
        "hideInput": true,
        "baseClasses": [
          "Start"
        ],
        "category": "Agent Flows",
        "description": "Starting point of the agentflow",
        "inputParams": [
          {
            "label": "Input Type",
            "name": "startInputType",
            "type": "options",
            "options": [
              {
                "label": "Chat Input",
                "name": "chatInput",
                "description": "Start the conversation with chat input"
              }
            ],
            "default": "chatInput"
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "startInputType": "chatInput"
        },
        "outputAnchors": [
          {
            "id": "startAgentflow_0-output-startAgentflow",
            "label": "Start",
            "name": "startAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 116,
      "height": 68
    },
    {
      "id": "stickyNote_purpose",
      "type": "stickyNote",
      "position": {
        "x": -700,
        "y": 50
      },
      "data": {
        "id": "stickyNote_purpose",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#fee440",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "PURPOSE:\nValidation-driven retry loop. Generator creates candidate, Validator runs tests/checks. Gate routes: PASS (tests pass) â†’ Return, FIX (retry available) â†’ Fix Planner â†’ retry, FAIL (max retries) â†’ Return with error. Tracks retry count (max 3) and validation history."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_purpose-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 122
    },
    {
      "id": "agent_generate",
      "type": "agentFlow",
      "position": {
        "x": -400,
        "y": 200
      },
      "data": {
        "id": "agent_generate",
        "label": "Agent.Generate",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#4DD0E1",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Create candidate output from prompt/context",
        "inputParams": [
          {
            "label": "Model",
            "name": "agentModel",
            "type": "asyncOptions",
            "loadMethod": "listModels",
            "loadConfig": true
          },
          {
            "label": "Messages",
            "name": "agentMessages",
            "type": "array",
            "optional": true,
            "acceptVariable": true
          },
          {
            "label": "Tools",
            "name": "agentTools",
            "type": "array",
            "optional": true
          },
          {
            "label": "Enable Memory",
            "name": "agentEnableMemory",
            "type": "boolean",
            "default": false,
            "optional": true
          },
          {
            "label": "Update State",
            "name": "agentStateUpdates",
            "type": "array",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentModel": "chatAnthropic",
          "agentMessages": "",
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            }
          ],
          "agentEnableMemory": true,
          "agentStateUpdates": [
            {
              "key": "candidate.output",
              "value": "{{ candidate }}"
            },
            {
              "key": "loop.retry_count",
              "value": "{{ loop.retry_count || 0 }}"
            }
          ],
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.3,
            "streaming": true,
            "agentModel": "chatAnthropic"
          }
        },
        "outputAnchors": [
          {
            "id": "agent_generate-output-agentAgentflow",
            "label": "Agent",
            "name": "agentAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 221,
      "height": 80
    },
    {
      "id": "agent_validate",
      "type": "agentFlow",
      "position": {
        "x": -100,
        "y": 200
      },
      "data": {
        "id": "agent_validate",
        "label": "Agent.Validator",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#9575CD",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Run tests/policy checks; output pass/fail + reasons",
        "inputParams": [
          {
            "label": "Model",
            "name": "agentModel",
            "type": "asyncOptions",
            "loadMethod": "listModels",
            "loadConfig": true
          },
          {
            "label": "Messages",
            "name": "agentMessages",
            "type": "array",
            "optional": true,
            "acceptVariable": true
          },
          {
            "label": "Tools",
            "name": "agentTools",
            "type": "array",
            "optional": true
          },
          {
            "label": "Enable Memory",
            "name": "agentEnableMemory",
            "type": "boolean",
            "default": false,
            "optional": true
          },
          {
            "label": "Update State",
            "name": "agentStateUpdates",
            "type": "array",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentModel": "chatAnthropic",
          "agentMessages": "",
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            }
          ],
          "agentEnableMemory": true,
          "agentStateUpdates": [
            {
              "key": "validation.pass",
              "value": "{{ pass }}"
            },
            {
              "key": "validation.reasons",
              "value": "{{ reasons }}"
            },
            {
              "key": "validation.fail_type",
              "value": "{{ fail_type }}"
            }
          ],
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.2,
            "streaming": true,
            "agentModel": "chatAnthropic"
          }
        },
        "outputAnchors": [
          {
            "id": "agent_validate-output-agentAgentflow",
            "label": "Agent",
            "name": "agentAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 221,
      "height": 80
    },
    {
      "id": "gate_validator",
      "type": "agentFlow",
      "position": {
        "x": 200,
        "y": 200
      },
      "data": {
        "id": "gate_validator",
        "label": "Validator Gate",
        "version": 1.1,
        "name": "conditionAgentAgentflow",
        "type": "ConditionAgent",
        "color": "#ff8fab",
        "baseClasses": [
          "ConditionAgent"
        ],
        "category": "Agent Flows",
        "description": "PASS vs FIX vs FAIL decision with retry budget",
        "inputParams": [
          {
            "label": "Model",
            "name": "conditionAgentModel",
            "type": "asyncOptions",
            "loadMethod": "listModels",
            "loadConfig": true
          },
          {
            "label": "Instructions",
            "name": "conditionAgentInstructions",
            "type": "string",
            "rows": 4,
            "placeholder": "Analyze the user input and route to the appropriate agent..."
          },
          {
            "label": "Input",
            "name": "conditionAgentInput",
            "type": "string",
            "acceptVariable": true
          },
          {
            "label": "Scenarios",
            "name": "conditionAgentScenarios",
            "type": "array",
            "array": [
              {
                "label": "Scenario",
                "name": "scenario",
                "type": "string",
                "rows": 2
              }
            ]
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "conditionAgentModel": "chatAnthropic",
          "conditionAgentInstructions": "Check validation result and retry budget:\n\nState variables:\n- validation.pass (boolean: tests passed?)\n- loop.retry_count (current retry attempt)\n- loop.max_retries (default 3)\n\nDecision logic:\nIF validation.pass = true â†’ PASS (success, return output)\nELSE IF retry_count < max_retries â†’ FIX (generate fix plan, retry)\nELSE â†’ FAIL (max retries exhausted, return error)\n\nIMPORTANT: FAIL path prevents returning broken code after max retries.\n\nOutput scenario: PASS (0), FIX (1), or FAIL (2)",
          "conditionAgentInput": "{{ validation }}",
          "conditionAgentScenarios": [
            {
              "scenario": "PASS - validation tests passed successfully"
            },
            {
              "scenario": "FIX - validation failed but retries remain"
            },
            {
              "scenario": "FAIL - max retries exhausted, cannot fix"
            }
          ],
          "conditionAgentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.1,
            "streaming": true,
            "conditionAgentModel": "chatAnthropic"
          }
        },
        "outputAnchors": [
          {
            "id": "gate_validator-output-0",
            "label": 0,
            "name": 0,
            "description": "PASS"
          },
          {
            "id": "gate_validator-output-1",
            "label": 1,
            "name": 1,
            "description": "FIX"
          },
          {
            "id": "gate_validator-output-2",
            "label": 2,
            "name": 2,
            "description": "FAIL"
          }
        ],
        "outputs": {}
      },
      "width": 221,
      "height": 100
    },
    {
      "id": "stickyNote_validation",
      "type": "stickyNote",
      "position": {
        "x": 200,
        "y": 350
      },
      "data": {
        "id": "stickyNote_validation",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#fee440",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "VALIDATION LOGIC:\nValidator runs automated checks (tests, policy, linting). Returns {pass: bool, reasons: [], fail_type: string}. Gate routes: tests pass â†’ PASS, tests fail + retries left â†’ FIX, tests fail + no retries â†’ FAIL (prevents broken output)."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_validation-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 122
    },
    {
      "id": "agent_fix_plan",
      "type": "agentFlow",
      "position": {
        "x": 500,
        "y": 100
      },
      "data": {
        "id": "agent_fix_plan",
        "label": "Agent.FixPlan",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#FF7043",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Propose fixes based on validation failures",
        "inputParams": [
          {
            "label": "Model",
            "name": "agentModel",
            "type": "asyncOptions",
            "loadMethod": "listModels",
            "loadConfig": true
          },
          {
            "label": "Messages",
            "name": "agentMessages",
            "type": "array",
            "optional": true,
            "acceptVariable": true
          },
          {
            "label": "Tools",
            "name": "agentTools",
            "type": "array",
            "optional": true
          },
          {
            "label": "Enable Memory",
            "name": "agentEnableMemory",
            "type": "boolean",
            "default": false,
            "optional": true
          },
          {
            "label": "Update State",
            "name": "agentStateUpdates",
            "type": "array",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentModel": "chatAnthropic",
          "agentMessages": "",
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            }
          ],
          "agentEnableMemory": true,
          "agentStateUpdates": [
            {
              "key": "fix_plan.actions",
              "value": "{{ fix_actions }}"
            },
            {
              "key": "loop.retry_count",
              "value": "{{ loop.retry_count + 1 }}"
            }
          ],
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.4,
            "streaming": true,
            "agentModel": "chatAnthropic"
          }
        },
        "outputAnchors": [
          {
            "id": "agent_fix_plan-output-agentAgentflow",
            "label": "Agent",
            "name": "agentAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 221,
      "height": 80
    },
    {
      "id": "stickyNote_retry",
      "type": "stickyNote",
      "position": {
        "x": 500,
        "y": -50
      },
      "data": {
        "id": "stickyNote_retry",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#fee440",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "RETRY LOGIC:\nFix Planner analyzes failure reasons (validation.reasons, fail_type), generates specific fixes, increments retry counter. Loop-back to Generator with fix context. Max 3 retries. Tracks fix effectiveness to detect same-error loops."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_retry-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 122
    },
    {
      "id": "agent_return",
      "type": "agentFlow",
      "position": {
        "x": 500,
        "y": 300
      },
      "data": {
        "id": "agent_return",
        "label": "Agent.Return",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#66BB6A",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Finalize output (success or failure)",
        "inputParams": [
          {
            "label": "Model",
            "name": "agentModel",
            "type": "asyncOptions",
            "loadMethod": "listModels",
            "loadConfig": true
          },
          {
            "label": "Messages",
            "name": "agentMessages",
            "type": "array",
            "optional": true,
            "acceptVariable": true
          },
          {
            "label": "Tools",
            "name": "agentTools",
            "type": "array",
            "optional": true
          },
          {
            "label": "Enable Memory",
            "name": "agentEnableMemory",
            "type": "boolean",
            "default": false,
            "optional": true
          },
          {
            "label": "Update State",
            "name": "agentStateUpdates",
            "type": "array",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentModel": "chatAnthropic",
          "agentMessages": "",
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            }
          ],
          "agentEnableMemory": true,
          "agentStateUpdates": [
            {
              "key": "output",
              "value": "{{ final_output }}"
            },
            {
              "key": "report.status",
              "value": "{{ status }}"
            },
            {
              "key": "report.retries",
              "value": "{{ loop.retry_count }}"
            },
            {
              "key": "report.validation_history",
              "value": "{{ validation_history }}"
            }
          ],
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.2,
            "streaming": true,
            "agentModel": "chatAnthropic"
          }
        },
        "outputAnchors": [
          {
            "id": "agent_return-output-agentAgentflow",
            "label": "Agent",
            "name": "agentAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 221,
      "height": 80
    },
    {
      "id": "stickyNote_output",
      "type": "stickyNote",
      "position": {
        "x": 500,
        "y": 450
      },
      "data": {
        "id": "stickyNote_output",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#fee440",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "OUTPUT FORMAT:\nReturn includes: 1) Final output (state.output) OR error message (FAIL path), 2) Status (PASS|FAIL), 3) Retry count (report.retries), 4) Validation history (all test runs), 5) Fix effectiveness metrics."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_output-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 122
    },
    {
      "id": "directReply_final",
      "type": "agentFlow",
      "position": {
        "x": 700,
        "y": 100
      },
      "data": {
        "id": "directReply_final",
        "label": "Direct Reply",
        "version": 1,
        "name": "directReplyAgentflow",
        "type": "DirectReply",
        "color": "#4DDBBB",
        "hideOutput": true,
        "baseClasses": [
          "DirectReply"
        ],
        "category": "Agent Flows",
        "description": "Directly reply to the user with a message and terminate the workflow",
        "inputParams": [
          {
            "label": "Message",
            "name": "directReplyMessage",
            "type": "string",
            "rows": 4,
            "acceptVariable": true,
            "id": "directReply_final-input-directReplyMessage-string",
            "display": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "directReplyMessage": "<p>âœ… <strong>Validation Complete</strong></p><p></p><p>Test-driven validation loop finished with outcome determination.</p><p></p><p>ðŸ“Š <strong>Execution Summary:</strong></p><p>â€¢ Generate â†’ candidate creation</p><p>â€¢ Validate â†’ automated testing</p><p>â€¢ Gate â†’ PASS/FIX/FAIL routing</p><p>â€¢ Fix Plan â†’ automated corrections (if needed)</p><p>â€¢ Return â†’ final status</p><p></p><p>Check status field for PASS/FAIL outcome and retry history.</p>"
        },
        "outputAnchors": [],
        "outputs": {}
      },
      "width": 205,
      "height": 67
    }
  ],
  "edges": [
    {
      "source": "startAgentflow_0",
      "sourceHandle": "startAgentflow_0-output-startAgentflow",
      "target": "agent_generate",
      "targetHandle": "agent_generate-input",
      "type": "buttonedge",
      "id": "edge_start_to_gen",
      "label": "input"
    },
    {
      "source": "agent_generate",
      "sourceHandle": "agent_generate-output-agentAgentflow",
      "target": "agent_validate",
      "targetHandle": "agent_validate-input",
      "type": "buttonedge",
      "id": "edge_gen_to_val",
      "label": "candidate"
    },
    {
      "source": "agent_validate",
      "sourceHandle": "agent_validate-output-agentAgentflow",
      "target": "gate_validator",
      "targetHandle": "gate_validator-input",
      "type": "buttonedge",
      "id": "edge_val_to_gate",
      "label": "result"
    },
    {
      "source": "gate_validator",
      "sourceHandle": "gate_validator-output-0",
      "target": "agent_return",
      "targetHandle": "agent_return-input",
      "type": "buttonedge",
      "id": "edge_gate_pass",
      "label": "PASS"
    },
    {
      "source": "gate_validator",
      "sourceHandle": "gate_validator-output-2",
      "target": "agent_return",
      "targetHandle": "agent_return-input",
      "type": "buttonedge",
      "id": "edge_gate_fail",
      "label": "FAIL"
    },
    {
      "source": "gate_validator",
      "sourceHandle": "gate_validator-output-1",
      "target": "agent_fix_plan",
      "targetHandle": "agent_fix_plan-input",
      "type": "buttonedge",
      "id": "edge_gate_fix",
      "label": "FIX"
    },
    {
      "source": "agent_fix_plan",
      "sourceHandle": "agent_fix_plan-output-agentAgentflow",
      "target": "agent_generate",
      "targetHandle": "agent_generate-input",
      "type": "buttonedge",
      "id": "edge_fix_loop_back",
      "label": "retry",
      "animated": true
    },
    {
      "source": "agent_return",
      "sourceHandle": "agent_return-output-agentAgentflow",
      "target": "directReply_final",
      "targetHandle": "directReply_final-input",
      "type": "buttonedge",
      "id": "edge_final_to_reply",
      "label": "complete"
    }
  ]
}
